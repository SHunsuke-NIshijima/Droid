# AI エージェント行動ガイドライン

## 基本原則

本プロジェクトにおける AI エージェント（Factory Droid, GitHub Copilot など）は、**再現性・説明可能性・人間による統制（Human-in-the-loop）**を最重要原則として行動します。

## 許可される行動

### コード作成・改善
- PowerShell スクリプトの改善提案
- Python テストコードの作成
- リファクタリング案の提示
- バグ修正の提案

### ドキュメント作成
- README やドキュメントの作成・更新
- コードコメントの追加
- API ドキュメントの生成

### 分析・レビュー
- コードレビュー
- セキュリティ脆弱性の検出
- パフォーマンス分析
- テストカバレッジの評価

## 禁止事項

### 直接的な変更
- `main` / `release` ブランチへの直接コミット
- CI/CD パイプラインの無断変更
- セキュリティ設定の削除・無効化

### 高リスク操作
- 本番環境への直接デプロイ
- データベースの直接操作
- 外部 API への無断アクセス
- システムファイルの変更

### 情報漏洩リスク
- API キーやパスワードの生成・保存
- 機密情報のログ出力
- 外部サービスへのデータ送信

## 承認が必要な変更

以下の変更は必ず人間の承認を得てから実施：

### 設計変更
- アーキテクチャの変更
- データ構造の変更
- API インターフェースの変更

### 重要機能
- CLI 実行フロー
- ログ出力仕様
- 設定ファイル構造
- エラーハンドリングロジック

### 外部依存
- 新しいライブラリの追加
- 既存ライブラリのバージョンアップ
- 外部サービスとの連携

## 作業フロー

### 1. 理解フェーズ
```
1. 現在のコードベースを確認
2. AGENTS.md とポリシーを読む
3. 関連するドキュメントを参照
4. 既存のパターンと規約を理解
```

### 2. 提案フェーズ
```
1. 変更内容を明確に説明
2. 影響範囲を特定
3. リスクを評価
4. 代替案を提示（必要に応じて）
```

### 3. 実装フェーズ
```
1. テストを先に作成（TDD）
2. コードを実装
3. ローカルでテスト実行
4. ドキュメントを更新
```

### 4. レビューフェーズ
```
1. セルフレビュー
2. 自動チェック（lint, test）
3. 変更内容の説明を作成
4. 人間によるレビューを依頼
```

## 出力品質基準

### コード
- [ ] コーディング規約に準拠
- [ ] エラーハンドリングを実装
- [ ] 適切なコメントを記載
- [ ] テストでカバー

### ドキュメント
- [ ] 日本語で記述
- [ ] Markdown 形式
- [ ] 前提条件を明記
- [ ] 実行例を含む

### 説明・レポート
- [ ] 変更の目的を明確に
- [ ] 影響範囲を特定
- [ ] リスクを評価
- [ ] 代替案を検討

## トレーサビリティ

すべての AI 生成コンテンツには以下を記録：

```markdown
## AI 生成情報
- 生成日時: YYYY-MM-DD HH:MM
- 目的: <変更の目的>
- プロンプト: <使用したプロンプト>
- レビュー者: <承認者名>
```

## 例外処理

予期しない状況に遭遇した場合：
1. 処理を中断
2. 状況を詳細に報告
3. 人間の判断を仰ぐ
4. 承認後に作業を再開

## 継続的改善

以下の情報を記録し、プロセス改善に活用：
- 頻繁に発生する問題
- 効果的だった提案パターン
- 改善が必要なガイドライン
- ユーザーフィードバック
